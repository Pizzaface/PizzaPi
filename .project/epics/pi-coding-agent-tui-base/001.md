---
name: CLI Package Scaffold
status: open
created: 2026-02-19T17:20:07Z
updated: 2026-02-19T17:20:07Z
beads_id: [Will be updated when synced to Beads]
depends_on: []
parallel: false
conflicts_with: []
---

# Task: CLI Package Scaffold

## Description

Create the `packages/cli` monorepo package — the PizzaPi-branded launcher that wraps `@mariozechner/pi-coding-agent`'s SDK. The binary `pizzapi` starts the full pi-coding-agent TUI with PizzaPi-specific defaults and config wiring. No TUI, providers, auth, or session management are reimplemented — they all come from pi-coding-agent.

## Acceptance Criteria

- [ ] `packages/cli` added to monorepo workspaces in root `package.json`
- [ ] `@mariozechner/pi-coding-agent` added as a dependency of `packages/cli`
- [ ] `pizzapi` binary entry point works: `bun run packages/cli/src/index.ts` launches full pi-coding-agent TUI
- [ ] Config loader merges `~/.pizzapi/config.json` (global) with `.pizzapi/config.json` (project-local); project-local wins
- [ ] `.agents/*.md` files in cwd are wired via `DefaultResourceLoader.agentsFilesOverride`
- [ ] Default system prompt injected from config (falls back to built-in pi default if not set)
- [ ] `--version` flag prints PizzaPi version (< 500ms startup)
- [ ] `packages/cli/package.json` has `bin.pizzapi` pointing to compiled entry

## Technical Details

- Use `createAgentSession()` + full TUI run mode from `@mariozechner/pi-coding-agent` SDK
- Config dir: `~/.pizzapi/` (global), `.pizzapi/` (project-local). Mirror pi-coding-agent's `~/.pi/` pattern but namespaced
- Read installed types from `node_modules/@mariozechner/pi-coding-agent/dist/` before implementing to match exact API shape
- `DefaultResourceLoader` accepts `agentsFilesOverride` callback — use it to append `.agents/*.md` files from cwd
- Config merge: deep merge JSON, project-local fields override global
- Files affected:
  - `package.json` (add cli workspace)
  - `packages/cli/package.json`
  - `packages/cli/tsconfig.json`
  - `packages/cli/src/index.ts`
  - `packages/cli/src/config.ts`

## Dependencies

- [ ] `@mariozechner/pi-coding-agent` available on npm (it is: `@mariozechner/pi-coding-agent@0.53.x`)
- [ ] Existing `@pizzapi/tools` package (may be passed as `customTools` to `createAgentSession()`)

## Effort Estimate

- Size: S
- Hours: 4–6
- Parallel: false (foundation for tasks 002 and 003)

## Definition of Done

- [ ] Code implemented
- [ ] `bun run dev` in packages/cli launches interactive TUI
- [ ] Config merge tested with conflicting global/project values
- [ ] `.agents/` wiring verified (create a test `.agents/test.md`, confirm it's loaded)
- [ ] Code reviewed
